<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Alertas</title>
    <style>
        /* O CSS permanece exatamente o mesmo */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* A div info-box n√£o √© mais necess√°ria, pois a janela come√ßa oculta */
            background-color: #f3f4f6;
        }

        #status {
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 9999;
        }

        .status-connected {
            background: #22c55e;
            color: white;
        }

        .status-disconnected {
            background: #ef4444;
            color: white;
        }

        /* Overlay do alerta (ainda usado para o conte√∫do) */
        #alertOverlay {
            /* A visibilidade agora √© controlada pelo Electron, mas a estrutura se mant√©m */
            display: block;
            /* Alterado de 'none' para 'block' */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            z-index: 999999;
        }

        #alertContainer {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        #alertHeader {
            padding: 40px;
            text-align: center;
            color: white;
            position: relative;
        }

        .alert-fire {
            background: linear-gradient(135deg, #dc2626, #ea580c);
        }

        .alert-attack {
            background: linear-gradient(135deg, #7c2d12, #dc2626);
        }

        .alert-emergency {
            background: linear-gradient(135deg, #dc2626, #991b1b);
        }

        .alert-evacuation {
            background: linear-gradient(135deg, #ea580c, #f59e0b);
        }

        #alertIcon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: pulse 1.5s ease-in-out infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }
        }

        #alertTitle {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #alertBody {
            padding: 40px;
            background: white;
        }

        #alertMessage {
            font-size: 24px;
            line-height: 1.6;
            color: #1f2937;
            margin-bottom: 30px;
            text-align: center;
        }

        #alertTime {
            text-align: center;
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 30px;
        }

        #acknowledgeBtn {
            display: block;
            width: 100%;
            padding: 20px;
            font-size: 20px;
            font-weight: bold;
            color: white;
            background: #dc2626;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.3s;
        }

        #acknowledgeBtn:hover {
            background: #991b1b;
        }

        #countdown {
            font-size: 18px;
            color: #6b7280;
            text-align: center;
            margin-top: 15px;
        }
    </style>
</head>

<body>
    <div id="status" class="status-disconnected">‚óè Desconectado</div>

    <div id="alertOverlay">
        <div id="alertContainer">
            <div id="alertHeader" class="alert-fire">
                <div id="alertIcon">üö®</div>
                <div id="alertTitle">ALERTA</div>
            </div>
            <div id="alertBody">
                <div id="alertMessage"></div>
                <div id="alertTime"></div>
                <button id="acknowledgeBtn">CONFIRMAR CI√äNCIA DO ALERTA</button>
                <div id="countdown"></div>
            </div>
        </div>
    </div>

    <audio id="alertSound" loop>
        <source
            src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZSA0PVqzn77FgGgU+lt7wwHEoCy6Dze/aizsIGGS56+mbUBELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUhELTKXh8bllHAU2j9byw3csBS1+zPLaiTkIGGa76+ejUg=="
            type="audio/wav">
    </audio>
    <!-- <footer>
        <p>&copy;2025 | Desenvolvido por <a href="https://devgui.com.br" target="_blank">Guilherme Araujo</a></p>
    </footer> -->

    <script>
        // Todas as constantes para elementos do DOM permanecem as mesmas
        const ws = new WebSocket('ws://192.168.1.104:3000');
        const statusEl = document.getElementById('status');
        const alertHeader = document.getElementById('alertHeader');
        const alertIcon = document.getElementById('alertIcon');
        const alertTitle = document.getElementById('alertTitle');
        const alertMessage = document.getElementById('alertMessage');
        const alertTime = document.getElementById('alertTime');
        const acknowledgeBtn = document.getElementById('acknowledgeBtn');
        const countdown = document.getElementById('countdown');
        const alertSound = document.getElementById('alertSound');

        let countdownInterval;
        let secondsToAcknowledge = 30;

        const alertConfig = {
            fire: { icon: 'üî•', title: 'INC√äNDIO DETECTADO', className: 'alert-fire' },
            attack: { icon: '‚ö†Ô∏è', title: 'AMEA√áA DE ATAQUE', className: 'alert-attack' },
            emergency: { icon: 'üö®', title: 'EMERG√äNCIA', className: 'alert-emergency' },
            evacuation: { icon: 'üö™', title: 'EVACUA√á√ÉO IMEDIATA', className: 'alert-evacuation' }
        };

        // Conex√£o WebSocket (l√≥gica permanece a mesma)
        ws.onopen = () => {
            console.log('Conectado ao servidor de alertas');
            statusEl.textContent = '‚óè Conectado';
            statusEl.className = 'status-connected';
        };

        ws.onclose = () => {
            console.log('Desconectado do servidor');
            statusEl.textContent = '‚óè Desconectado';
            statusEl.className = 'status-disconnected';
            setTimeout(() => location.reload(), 5000);
        };

        ws.onerror = (error) => {
            console.error('Erro no WebSocket:', error);
        };

        // =======================================================
        // MUDAN√áA PRINCIPAL AQUI
        // =======================================================

        // Receber alertas
        ws.onmessage = (event) => {
            const alert = JSON.parse(event.data);

            // 1. Preenche o conte√∫do do alerta na p√°gina
            populateAlertContent(alert);

            // 2. Avisa o processo principal do Electron para MOSTRAR a janela
            window.electronAPI.showAlert();
        };

        // Confirmar ci√™ncia do alerta
        acknowledgeBtn.addEventListener('click', () => {
            // 1. Para os processos locais (som, contador)
            alertSound.pause();
            alertSound.currentTime = 0;
            clearInterval(countdownInterval);
            countdown.style.color = '#6b7280';
            countdown.style.fontWeight = 'normal';

            // 2. Avisa o processo principal do Electron para ESCONDER a janela
            window.electronAPI.hideAlert();

            console.log('Alerta confirmado pelo usu√°rio');
        });


        /**
         * Nova fun√ß√£o apenas para popular o conte√∫do do alerta.
         * Ela n√£o controla mais a visibilidade.
         */
        function populateAlertContent(alert) {
            const config = alertConfig[alert.type] || alertConfig.emergency;

            // Configurar conte√∫do do alerta
            alertIcon.textContent = config.icon;
            alertTitle.textContent = config.title;
            alertMessage.textContent = alert.message;

            const time = new Date(alert.timestamp);
            alertTime.textContent = `Alerta emitido √†s ${time.toLocaleTimeString('pt-BR')}`;

            alertHeader.className = config.className;

            // Tocar som de alerta
            alertSound.play().catch(e => console.log('N√£o foi poss√≠vel tocar o som:', e));

            // Iniciar contagem regressiva
            startCountdown();
        }

        function startCountdown() {
            secondsToAcknowledge = 30;
            countdown.textContent = `Voc√™ deve confirmar em ${secondsToAcknowledge} segundos`;

            clearInterval(countdownInterval);
            countdownInterval = setInterval(() => {
                secondsToAcknowledge--;
                countdown.textContent = `Voc√™ deve confirmar em ${secondsToAcknowledge} segundos`;

                if (secondsToAcknowledge <= 0) {
                    countdown.textContent = 'CONFIRME IMEDIATAMENTE!';
                    countdown.style.color = '#dc2626';
                    countdown.style.fontWeight = 'bold';
                }
            }, 1000);
        }

        // As fun√ß√µes de preven√ß√£o (fechar aba, ESC) continuam √∫teis
        // pois o Electron ainda as respeita dentro da janela.
        window.addEventListener('beforeunload', (e) => {
            // Isso previne que a janela seja fechada acidentalmente pelo ALT+F4
            e.preventDefault();
            e.returnValue = '';
        });

        document.addEventListener('keydown', (e) => {
            // Isso previne que ESC saia do modo tela cheia
            if (e.key === 'Escape') {
                e.preventDefault();
                return false;
            }
        });
    </script>
</body>

</html>